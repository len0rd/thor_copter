<!--Basic launch file to get thor in the air with sensors connected to ros
    @author @len0rd
    @since 2018-10-04 -->

<launch>

    <rosparam command="load" file="$(find thorcopter)/params/vi_ekf_params.yaml" ns="vi_ekf_node" />

    <!-- Start inertial sense -->
    <node pkg="inertial_sense" type="inertial_sense_node" name="inertial_sense_node" output="screen">
        <param name="port" value="/dev/ttyUSB1" />
        <param name="INS_rpy" value="{0, 0, 4.7124}" />
        <param name="stream_IMU" value="true" />
        <!-- We only need imu and gps. turn off the default /ins topic to save bandwidth-->
        <!-- <param name="stream_INS" value="false" /> -->
        <param name="stream_baro" value="true" />
        <!-- <param name="stream_mag" value="true" /> -->
        <param name="stream_GPS" value="true" />
        <remap from="baro" to="ins/baro" />
    </node>

    <!-- Start rosflight -->
    <node pkg="rosflight" type="rosflight_io" name="rosflight" output="screen">
        <param name="port" value="/dev/naze"/>
        <param name="baud" value="921600"/>
    </node>

    <!-- Create a node that picks up on magicc's mocap system -->
    <node pkg="vrpn_client_ros" type="vrpn_client_node" name="vrpn_client_node" output="screen">
        <param name="refresh_tracker_frequency" value="1" />
        <param name="server" value="192.168.1.186" />
        <remap from="vrpn_client_node/Thor/pose" to="truth/pose" />
    </node>

    <!-- Tell the controller that we are flying -->
    <node pkg="rostopic" type="rostopic" name="is_flying_pub" args="pub is_flying std_msgs/Bool true"/>    
  
    <!-- Startup the vi_ekf node -->
    <node pkg="roscopter" name="vi_ekf_node" type="vi_ekf_node" output="screen"/>
    
    <!-- bag imu, gps, ins, sonar, baro, mag, mocap -->
    <node name="record" pkg="rosbag" type="record" args="/imu /gps /imu/data /ins /sonar /ins/baro /magnetometer /truth/pose" />
</launch>
